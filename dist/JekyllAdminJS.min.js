/**
 * AdminJS v0.1
 *
 * @link   https://github.com/bugra9/JekyllAdminJS
 * @author bugra9 https://github.com/bugra9
 * @license GPLv3
 */
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),JekyllAdminJS=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:"deleteData",value:function(t){this.github.delete(t)}},{key:"renameData",value:function(t,e){this.github.rename(t,e)}},{key:"saveData",value:function(t,e){function i(t){return encodeURI(t).split(/%..|./).length-1}var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e["file.path"],a=e.content;delete e["file.path"],delete e.content;var l="---\n"+jsyaml.dump(e)+"---\n";l+=a;var n={};if(n.file={path:r,mode:"100644",type:"blob",size:i(l)},n.content=e,n.content.content=a,this.github.add(r,l,!1),o)this.data.push(n);else{var s=this.findAll([{attr:"file.path",value:t,op:"=="}])[0];this.data[s]=n,t!=r&&this.github.delete(t)}}},{key:"commit",value:function(t){$("#loader").show(),console.log("Commit..."),this.github.commit("Değişiklikler kaydediliyor..."),this.github.error?alert(this.github.error):window.location.href="#list/_posts/"}},{key:"loadData",value:function(){this.github=new Github("",localStorage.token,"bugra9/bugra9.github.io/master"),this.data=[];var t=this.getTree();for(var e in t)if("040000"!=t[e].mode){var i={file:t[e]};if(this.isText(t[e].path)&&void 0===localStorage[t[e].sha]){var o=this.b64DecodeUnicode(this.github.getData(t[e].url).content);if(this.github.error)return void alert(this.github.error);if(0===o.indexOf("---")){o=o.split("---",3);var r=jsyaml.load(o[1]);r.content=o[2],localStorage[t[e].sha]=JSON.stringify(r)}else localStorage[t[e].sha]=JSON.stringify({content:o})}this.isText(t[e].path)&&(i.content=JSON.parse(localStorage[t[e].sha])),this.data.push(i)}}},{key:"isText",value:function(t){var e=t.lastIndexOf(".");return e!=-1&&["markdown","mkdown","mkdn","mkd","md","js","css","txt","html","htm"].indexOf(t.substring(e+1))!=-1}},{key:"getTree",value:function(){var t=this.github.getData("git/refs/heads/master").object;if(this.github.error)return void alert(this.github.error);if(void 0===localStorage.shaLatestCommit||t.sha!=localStorage.shaLatestCommit){console.log("Yeni ağaç yükleniyor..."),localStorage.shaLatestCommit=t.sha;var e=this.github.getData(this.github.getData(t.url).tree.url+"?recursive=1");return this.github.error?void alert(this.github.error):(localStorage.shaTree=e.sha,localStorage[e.sha]=JSON.stringify(e.tree),e.tree)}return JSON.parse(localStorage[localStorage.shaTree])}},{key:"b64DecodeUnicode",value:function(t){return decodeURIComponent(Array.prototype.map.call(atob(t),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))}},{key:"loadMenu",value:function(){this.menu=[{title:"Assets",path:"list/assets/",color:"blue",count:"5192"},{title:"Posts",path:"list/_posts/",color:"green",count:"82"},{title:"Pages",path:"list/_root/",color:"orange",count:"5"},{title:"Categories",path:"list/_category/",color:"yellow",count:"5"},{title:"Tags",path:"list/_tag/",color:"olive",count:"356"},{title:"Yazar",path:"list/_other/author/",color:"teal",count:"25"},{html:'<div class="ui  small header center aligned inverted">Advanced</div>'},{title:"Extensions",path:"list/_extension/",color:"pink",count:"12"},{title:"Themes",path:"list/_theme/",color:"red",count:"1"},{html:'<div class="ui  small header center aligned inverted">System</div>'},{title:"Commit",path:"commit()",color:"",count:"0"}]}},{key:"loadOption",value:function(){this.options={"/":[{attr:"file.path",title:"Konum",list:{show:!1},edit:{order:1,section:2},input:{type:"text"}},{attr:"title",title:"Başlık",list:{show:!0},edit:{order:1},input:{type:"text"}},{attr:"content",title:"İçerik",list:{show:!1},edit:{type:2,order:1,section:3},input:{type:"text",wysiwyg:!0}}],"/_posts/":[{attr:"title",title:"Makale Başlığı",list:{show:!0},edit:{type:2,order:1},input:{type:"text"}},{attr:"summary",title:"Özet",list:{show:!1},edit:{type:2,order:2},input:{type:"text",rows:2}},{attr:"image",title:"Resim",list:{show:!1},edit:{type:2,order:6},input:{type:"text"}},{attr:"thumb",title:"Resim",list:{show:!1},edit:{type:2,order:6},input:{type:"text"}},{attr:"permalink",title:"Permalink",list:{show:!1},edit:{type:2,order:2,section:2},input:{type:"text"}},{attr:"date",title:"Zaman",list:{show:!0},edit:{type:2,order:3,section:2},input:{type:"date"}},{attr:"author",title:"Yazar",list:{show:!0},edit:{type:2,order:5},input:{type:"select",isRelated:!0,multiple:!1,options:[{attr:"file.path",value:"_other/author/",op:"contain"}],value:"title"}},{attr:"categories",title:"Kategori",list:{show:!0},edit:{type:2,order:3},input:{type:"select",isRelated:!0,multiple:!1,options:[{attr:"file.path",value:"_category/",op:"contain"}],value:"code"}},{attr:"tags",title:"Etiketler",list:{show:!1},edit:{type:2,order:4},input:{type:"select",isRelated:!0,multiple:!0,options:[{attr:"file.path",value:"_tag/",op:"contain"}],value:"title"}}]}}}]),e}(AdminJS);